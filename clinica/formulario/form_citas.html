<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solicitud de Cita - Cl√≠nica Dental</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>

<div class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center bg-no-repeat relative" 
     style="background-image: linear-gradient(180deg, #0000008c 0%, #0000008c 100%), url('../images/dentista.jpg');">

  <a href="../index.html" 
     class="absolute top-5 right-5 bg-[#C62828] text-white font-semibold px-4 py-2 rounded-md shadow-md hover:bg-[#B71C1C] transition">
     ‚Üê Volver al Inicio
  </a>

  <div class="max-w-xl w-full bg-white/95 p-8 rounded-lg shadow-2xl border-t-4 border-[#7D0000] backdrop-blur-sm">
    
    <h2 class="text-3xl font-bold text-center text-[#7D0000] mb-6">ü¶∑ Solicitar Cita Odontol√≥gica</h2>
    <p class="text-center text-gray-700 mb-8">Por favor, rellena tus datos para agendar una cita.</p>

    <form id="citaForm" class="space-y-6">
      
      <!-- 1. Datos personales -->
      <section>
        <h3 class="text-xl font-semibold text-[#B71C1C] border-b pb-2 mb-4 border-[#F8BBD0]">1. Datos Personales</h3>
        <label class="block text-sm font-medium text-[#7D0000]">Nombre Completo</label>
        <input type="text" name="nombre" required class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-3" placeholder="Ej: Juan P√©rez">

        <label class="block text-sm font-medium text-[#7D0000]">Correo Electr√≥nico</label>
        <input type="email" name="email" required class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-3" placeholder="ejemplo@correo.com">

        <label class="block text-sm font-medium text-[#7D0000]">Tel√©fono</label>
        <input type="tel" name="telefono" required class="w-full px-3 py-2 border border-[#E57373] rounded-md" placeholder="Ej: 555-1234567">
      </section>

      <!-- 2. Detalles de la cita -->
      <section>
        <h3 class="text-xl font-semibold text-[#B71C1C] border-b pb-2 mb-4 border-[#F8BBD0]">2. Detalle de la Cita</h3>
        <label class="block text-sm font-medium text-[#7D0000]">Fecha Preferida</label>
        <input type="date" name="fecha_solicitud" required class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-3">

        <label class="block text-sm font-medium text-[#7D0000]">Hora Preferida</label>
        <input type="time" name="hora_solicitud" required class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-3">

        <label class="block text-sm font-medium text-[#7D0000]">Motivo (opcional)</label>
        <textarea name="motivo" rows="3" class="w-full px-3 py-2 border border-[#E57373] rounded-md" placeholder="Breve descripci√≥n del motivo..."></textarea>
      </section>

      <!-- 3. M√©todo de pago -->
      <section>
        <h3 class="text-xl font-semibold text-[#B71C1C] border-b pb-2 mb-4 border-[#F8BBD0]">3. M√©todo de Pago</h3>
        <select id="metodo_pago" name="metodo_pago" class="w-full px-3 py-2 border border-[#E57373] rounded-md" onchange="toggleTarjetaCampos()">
          <option value="efectivo">Efectivo</option>
          <option value="tarjeta">Tarjeta</option>
        </select>

        <div id="tarjetaCampos" class="mt-4 hidden">
          <h4 class="font-semibold text-[#7D0000] mb-2">Datos de la Tarjeta</h4>
          <input type="text" name="nombre_titular" class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-2" placeholder="Nombre del titular">
          <input type="text" name="numero_tarjeta" class="w-full px-3 py-2 border border-[#E57373] rounded-md mb-2" placeholder="N√∫mero de tarjeta">
          <div class="flex space-x-2">
            <input type="text" name="vencimiento" class="w-1/2 px-3 py-2 border border-[#E57373] rounded-md" placeholder="MM/AA">
            <input type="text" name="cvv" class="w-1/2 px-3 py-2 border border-[#E57373] rounded-md" placeholder="CVV">
          </div>
        </div>
      </section>

      <!-- Mensaje de estado -->
      <div id="statusMessage" class="hidden p-3 mb-4 text-sm text-center rounded-lg" role="alert"></div>

      <!-- Bot√≥n -->
      <button type="submit" id="submitButton"
              class="w-full py-3 bg-[#C62828] text-white rounded-md font-semibold shadow-md hover:bg-[#B71C1C] transition">
        Solicitar y Enviar Cita
      </button>
    </form>
  </div>
</div>

<script>
function toggleTarjetaCampos() {
  const metodo = document.getElementById('metodo_pago').value;
  document.getElementById('tarjetaCampos').classList.toggle('hidden', metodo !== 'tarjeta');
}

document.getElementById('citaForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries());

  const status = document.getElementById('statusMessage');
  const button = document.getElementById('submitButton');
  button.disabled = true;
  button.textContent = 'Enviando...';

  try {
    const response = await fetch('../api/procesar_cita.php', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data)
    });

    const result = await response.json();
    status.classList.remove('hidden');
    if (result.success) {
      status.textContent = '‚úÖ Cita registrada correctamente.';
      status.className = 'bg-green-100 text-green-700 p-3 rounded-lg text-center';
      e.target.reset();
      toggleTarjetaCampos();
    } else {
      status.textContent = '‚ùå ' + result.message;
      status.className = 'bg-red-100 text-red-700 p-3 rounded-lg text-center';
    }
  } catch (err) {
    status.textContent = '‚ùå Error de conexi√≥n.';
    status.className = 'bg-red-100 text-red-700 p-3 rounded-lg text-center';
  } finally {
    button.disabled = false;
    button.textContent = 'Solicitar y Enviar Cita';
  }
});
</script>

</body>
</html>
